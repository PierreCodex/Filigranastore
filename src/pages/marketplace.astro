---
import Layout from '../layouts/Layout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

// Datos completos de productos organizados por las nuevas categorías
const products = [
  // Aretes (38 productos)
  {
    id: 1,
    name: "Aretes de Filigrana Clásicos",
    category: "Aretes",
    price: "S/ 120.00",
    image: "/AretesGuia.png",
    description: "Elegantes aretes elaborados con técnica tradicional de filigrana en plata 950. Diseño clásico que resalta la belleza femenina.",
    details: ["Material: Plata 950", "Técnica: Filigrana tradicional", "Peso: 8 gramos", "Dimensiones: 3cm x 2cm"],
    whatsappMessage: "Hola, me interesa el producto: Aretes de Filigrana Clásicos - S/ 120.00"
  },
  {
    id: 2,
    name: "Aretes Pequeños Delicados",
    category: "Aretes",
    price: "S/ 85.00",
    image: "/aretespequeños.jpg",
    description: "Aretes pequeños y delicados perfectos para uso diario. Elaborados con filigrana fina en plata.",
    details: ["Material: Plata 925", "Técnica: Filigrana fina", "Peso: 4 gramos", "Dimensiones: 1.5cm x 1cm"],
    whatsappMessage: "Hola, me interesa el producto: Aretes Pequeños Delicados - S/ 85.00"
  },
  {
    id: 3,
    name: "Aretes Colgantes Elegantes",
    category: "Aretes",
    price: "S/ 145.00",
    image: "/AretesGuia.png",
    description: "Aretes colgantes con diseño elegante y sofisticado en filigrana de plata.",
    details: ["Material: Plata 950", "Técnica: Filigrana colgante", "Peso: 12 gramos", "Dimensiones: 4cm x 2cm"],
    whatsappMessage: "Hola, me interesa el producto: Aretes Colgantes Elegantes - S/ 145.00"
  },
  {
    id: 4,
    name: "Aretes Redondos Tradicionales",
    category: "Aretes",
    price: "S/ 95.00",
    image: "/aretespequeños.jpg",
    description: "Aretes redondos con diseño tradicional de filigrana cataquense.",
    details: ["Material: Plata 925", "Técnica: Filigrana circular", "Peso: 6 gramos", "Dimensiones: 2cm diámetro"],
    whatsappMessage: "Hola, me interesa el producto: Aretes Redondos Tradicionales - S/ 95.00"
  },
  {
    id: 5,
    name: "Aretes Mariposa Delicados",
    category: "Aretes",
    price: "S/ 110.00",
    image: "/AretesGuia.png",
    description: "Hermosos aretes con forma de mariposa, símbolo de transformación y belleza.",
    details: ["Material: Plata 925", "Técnica: Filigrana figurativa", "Peso: 7 gramos", "Dimensiones: 2.5cm x 2cm"],
    whatsappMessage: "Hola, me interesa el producto: Aretes Mariposa Delicados - S/ 110.00"
  },
  
  // Anillos (10 productos)
  {
    id: 6,
    name: "Anillo Solitario Filigrana",
    category: "Anillos",
    price: "S/ 180.00",
    image: "/mono.png",
    description: "Elegante anillo solitario con técnica de filigrana tradicional.",
    details: ["Material: Plata 950", "Técnica: Filigrana clásica", "Peso: 15 gramos", "Tallas: 6-10"],
    whatsappMessage: "Hola, me interesa el producto: Anillo Solitario Filigrana - S/ 180.00"
  },
  {
    id: 7,
    name: "Anillo Banda Ancha",
    category: "Anillos",
    price: "S/ 220.00",
    image: "/mono.png",
    description: "Anillo de banda ancha con intrincados diseños de filigrana.",
    details: ["Material: Plata 950", "Técnica: Filigrana compleja", "Peso: 20 gramos", "Tallas: 6-10"],
    whatsappMessage: "Hola, me interesa el producto: Anillo Banda Ancha - S/ 220.00"
  },
  {
    id: 8,
    name: "Anillo Floral Delicado",
    category: "Anillos",
    price: "S/ 165.00",
    image: "/mono.png",
    description: "Anillo con motivos florales elaborado en filigrana fina.",
    details: ["Material: Plata 925", "Técnica: Filigrana floral", "Peso: 12 gramos", "Tallas: 5-9"],
    whatsappMessage: "Hola, me interesa el producto: Anillo Floral Delicado - S/ 165.00"
  },
  
  // Prendedores (5 productos)
  {
    id: 9,
    name: "Prendedor Colibrí",
    category: "Prendedores",
    price: "S/ 95.00",
    image: "/PrendedorColibri.jpg",
    description: "Hermoso prendedor con forma de colibrí, símbolo de libertad y belleza. Ideal para ocasiones especiales.",
    details: ["Material: Plata 925", "Técnica: Filigrana detallada", "Peso: 12 gramos", "Dimensiones: 4cm x 3cm"],
    whatsappMessage: "Hola, me interesa el producto: Prendedor Colibrí - S/ 95.00"
  },
  {
    id: 10,
    name: "Prendedor Mariposa Elegante",
    category: "Prendedores",
    price: "S/ 115.00",
    image: "/PrendedorColibri.jpg",
    description: "Prendedor con diseño de mariposa en filigrana detallada.",
    details: ["Material: Plata 950", "Técnica: Filigrana ornamental", "Peso: 14 gramos", "Dimensiones: 4.5cm x 3.5cm"],
    whatsappMessage: "Hola, me interesa el producto: Prendedor Mariposa Elegante - S/ 115.00"
  },
  
  // Adornos (5 productos)
  {
    id: 11,
    name: "Escultura helicóptero",
    category: "Adornos",
    price: "S/ 450.00",
    image: "/Pavo.jpg",
    description: "Pieza escultórica elaborada íntegramente con la técnica de la filigrana, que consiste en el tejido con hilos de plata. La escultura representa a un helicóptero.",
    details: ["Material: Plata 950", "Técnica: Filigrana escultórica", "Peso: 180 gramos", "Dimensiones: 13 cm (alto) x 30.5 cm (largo con hélices) "],
    whatsappMessage: "Hola, me interesa el producto: Escultura helicóptero - S/ 450.00"
  },
  {
    id: 12,
    name: "Porta lapiceros Tumi",
    category: "Adornos",
    price: "S/ 380.00",
    image: "/caballo.png",
    description: "Porta lapiceros elaborado en plata con escultura de tumi, elaborada íntegramente con la técnica de la filigrana, que consiste en el tejido con hilos de plata.",
    details: ["Material: Plata 950", "Técnica: Filigrana tradicional", "Peso: 150 gramos", "Dimensiones: 12 cm (alto) x 7.5 cm (ancho)"],
    whatsappMessage: "Hola, me interesa el producto: Porta lapiceros Tumi - S/ 380.00"
  },
  {
    id: 13,
    name: "Porta lapiceros Guadalupe",
    category: "Adornos",
    price: "S/ 320.00",
    image: "/Deflin.jpg",
    description: "Porta lapiceros elaborado en plata con escultura de guadalupe, elaborada íntegramente con la técnica de la filigrana, que consiste en el tejido con hilos de plata.",
    details: ["Material: Plata 950", "Técnica: Filigrana ornamental", "Peso: 120 gramos", "Dimensiones: 11 cm (alto) x 6.5 cm (ancho)"],
    whatsappMessage: "Hola, me interesa el producto: Porta lapiceros Guadalupe - S/ 320.00"
  },
  
  // Porta lapiceros (3 productos)
  {
    id: 14,
    name: "Porta lapiceros Tumi",
    category: "Porta lapiceros",
    price: "S/ 85.00",
    image: "/Se.png",
    description: "Porta lapiceros elaborado en plata con escultura de tumi, elaborada íntegramente con la técnica de la filigrana, que consiste en el tejido con hilos de plata.",
    details: ["Material: Plata 925", "Técnica: Filigrana funcional", "Peso: 45 gramos", "Dimensiones: 12 cm (alto) x 7.5 cm (ancho)"],
    whatsappMessage: "Hola, me interesa el producto: Porta lapiceros Tumi - S/ 85.00"
  },
  {
    id: 15,
    name: "Porta lapiceros chalán",
    category: "Porta lapiceros",
    price: "S/ 95.00",
    image: "/Se.png",
    description: "Porta lapiceros con diseños decorativos en filigrana tradicional.",
    details: ["Material: Plata 925", "Técnica: Filigrana decorativa", "Peso: 50 gramos", "Dimensiones: 9cm x 7cm"],
    whatsappMessage: "Hola, me interesa el producto: Porta Lapiceros Decorativo - S/ 95.00"
  },
  {
    id: 16,
    name: "Porta lapiceros chalán",
    category: "Porta lapiceros",
    price: "S/ 95.00",
    image: "/Se.png",
    description: "Porta lapiceros con diseños decorativos en filigrana tradicional.",
    details: ["Material: Plata 925", "Técnica: Filigrana decorativa", "Peso: 50 gramos", "Dimensiones: 9cm x 7cm"],
    whatsappMessage: "Hola, me interesa el producto: Porta Lapiceros Decorativo - S/ 95.00"
  },
  
  // Collares (2 productos)
  {
    id:17,
    name: "Collar Cadena Filigrana",
    category: "Collares",
    price: "S/ 280.00",
    image: "/mono.png",
    description: "Collar con cadena elaborada en eslabones de filigrana. Diseño elegante y resistente.",
    details: ["Material: Plata 950", "Técnica: Filigrana robusta", "Peso: 45 gramos", "Dimensiones: 47 cm (largo) "],
    whatsappMessage: "Hola, me interesa el producto: Collar Cadena Filigrana - S/ 280.00"
  },
  {
    id: 18,
    name: "Collar Cruz Religiosa",
    category: "Collares",
    price: "S/ 150.00",
    image: "/Se.png",
    description: "Collar con cruz religiosa elaborada en filigrana de plata, ideal para devoción personal.",
    details: ["Material: Plata 925", "Técnica: Filigrana religiosa", "Peso: 25 gramos", "Dimensiones: 7.4 cm (alto) x 4.2 cm (ancho)"],
    whatsappMessage: "Hola, me interesa el producto: Collar Cruz Religiosa - S/ 150.00"
  },
  
  // Pulseras (1 producto)
  {
    id: 19,
    name: "Pulsera",
    category: "Pulseras",
    price: "S/ 195.00",
    image: "/mono.png",
    description: "Pieza elaborada íntegramente con la técnica de la filigrana, que consiste en el tejido con hilos de plata. La pulsera es ajustable. ",
    details: [ "Longitud: 1.2 cm (alto) "],
    whatsappMessage: "Hola, me interesa el producto: Pulsera  - S/ 175.00"
  }
];

// Categorías con contadores exactos según especificación
const categories = [
  { name: "Todas las Categorías", count: 64 },
  { name: "Adornos", count: 5 },
  { name: "Anillos", count: 10 },
  { name: "Aretes", count: 38 },
  { name: "Collares", count: 2 },
  { name: "Porta lapiceros", count: 3 },
  { name: "Prendedores", count: 5 },
  { name: "Pulseras", count: 1 }
];

const whatsappNumber = "51987654321"; // Número de WhatsApp del artesano
---

<Layout title="Marketplace - Filigrana Victor Hugo Yarleque">
  <Nav />
  
  <main class="min-h-screen bg-cream pt-20">
    <div class="w-[90vw] max-w-[1400px] mx-auto py-12">
      
      <!-- Encabezado del Marketplace -->
      <div class="text-center mb-12">
        <h1 class="text-charcoal text-4xl md:text-6xl font-bold mb-4">MARKETPLACE</h1>
        <h2 class="text-gold text-2xl md:text-3xl font-semibold mb-6">Filigrana de Catacaos</h2>
        <p class="text-warm-gray-dark text-lg max-w-3xl mx-auto leading-relaxed">
          Explora nuestra colección completa de piezas únicas elaboradas con la tradicional técnica de filigrana. 
          Cada producto es una obra de arte creada por el maestro Victor Hugo Yarleque.
        </p>
      </div>

      <!-- Filtros por categoría -->
      <div class="mb-12">
        <div class="flex flex-wrap justify-center gap-3 md:gap-4">
          {categories.map(category => (
            <button 
              class="category-filter px-4 py-2 md:px-6 md:py-3 rounded-full border-2 border-gold text-gold hover:bg-gradient-to-r hover:from-gold hover:to-bronze hover:text-charcoal transition-all duration-300 font-semibold text-sm md:text-base shadow-lg hover:shadow-xl transform hover:scale-105 hover:-translate-y-1 flex items-center gap-2"
              data-category={category.name}
            >
              <span>{category.name}</span>
              <span class="bg-gold text-charcoal px-2 py-1 rounded-full text-xs font-bold">
                {category.count}
              </span>
            </button>
          ))}
        </div>
      </div>

      <!-- Grid de productos -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8" id="products-grid">
        {products.map(product => (
          <div class="product-card bg-ivory border-2 border-warm-gray-light rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl hover:border-gold transition-all duration-300 transform hover:scale-105" data-category={product.category}>
            
            <!-- Imagen del producto -->
            <div class="aspect-square overflow-hidden">
              <img 
                src={product.image} 
                alt={product.name}
                class="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
              />
            </div>
            
            <!-- Información del producto -->
            <div class="p-6">
              <!-- Categoría -->
              <span class="inline-block bg-gradient-to-r from-gold to-bronze text-charcoal px-3 py-1 rounded-full text-xs font-bold mb-3 uppercase tracking-wide">
                {product.category}
              </span>
              
              <!-- Nombre del producto -->
              <h3 class="text-charcoal text-xl font-bold mb-2 leading-tight">
                {product.name}
              </h3>
              
              <!-- Precio -->
              <p class="text-gold text-2xl font-bold mb-4">
                {product.price}
              </p>
              
              <!-- Descripción -->
              <p class="text-warm-gray-dark text-sm mb-6 leading-relaxed">
                {product.description}
              </p>
              
              <!-- Botones de acción -->
              <div class="flex flex-col gap-3">
                <!-- Botón Mostrar/Ocultar Detalles -->
                <button 
                  onclick={`toggleDetails(${product.id})`}
                  class="w-full bg-gold text-charcoal font-semibold py-2 px-4 rounded-lg hover:bg-bronze transition-all duration-300 border-2 border-transparent hover:border-charcoal"
                >
                  Ver Detalles
                </button>
                
                <!-- Botón de WhatsApp -->
                <a 
                  href={`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(product.whatsappMessage)}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="group w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 hover:shadow-lg transform hover:scale-105 hover:-translate-y-1 flex items-center justify-center gap-2 border-2 border-transparent hover:border-green-300"
                >
                  <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                  </svg>
                  <span class="text-base font-bold">Comprar por WhatsApp</span>
                </a>
              </div>
              
              <!-- Panel de detalles (oculto por defecto) -->
              <div id={`details-${product.id}`} class="hidden mt-4 p-4 bg-warm-gray-light rounded-lg border-l-4 border-gold">
                <h4 class="text-charcoal font-bold mb-2">Detalles del Producto</h4>
                <div class="text-warm-gray-dark text-sm space-y-2">
                  <p><strong>Categoría:</strong> {product.category}</p>
                  <p><strong>Precio:</strong> {product.price}</p>
                  <p><strong>Descripción:</strong> {product.description}</p>
                  {product.details && (
                    <p><strong>Detalles adicionales:</strong> {product.details}</p>
                  )}
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Mensaje cuando no hay productos -->
      <div id="no-products" class="hidden text-center py-12">
        <div class="text-warm-gray-dark text-xl mb-4">
          No se encontraron productos en esta categoría
        </div>
        <button 
          class="category-filter group px-8 py-4 bg-gradient-to-r from-gold to-bronze hover:from-bronze hover:to-gold text-charcoal rounded-full font-bold hover:shadow-xl transition-all duration-300 transform hover:scale-105 hover:-translate-y-1 border-2 border-transparent hover:border-charcoal flex items-center gap-2 mx-auto"
          data-category="Todas las Categorías"
        >
          <span>Ver todos los productos</span>
          <svg class="w-5 h-5 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>
  </main>

  <Footer />

  <script>
    // Funcionalidad de filtros con contadores dinámicos
    document.addEventListener('DOMContentLoaded', function() {
      const filterButtons = document.querySelectorAll('.category-filter');
      const productCards = document.querySelectorAll('.product-card');
      const noProductsMessage = document.getElementById('no-products');

      // Función para actualizar contadores dinámicamente
      function updateCategoryCounters() {
        filterButtons.forEach(button => {
          const categoryName = button.getAttribute('data-category');
          const counterSpan = button.querySelector('span:last-child');
          
          // Verificar que el span del contador existe
          if (!counterSpan) return;
          
          let count = 0;
          if (categoryName === 'Todas las Categorías') {
            // Contar todos los productos visibles
            productCards.forEach(card => {
              if (card.style.display !== 'none') {
                count++;
              }
            });
          } else {
            // Contar productos de la categoría específica que están visibles
            productCards.forEach(card => {
              const cardCategory = card.getAttribute('data-category');
              if (cardCategory === categoryName && card.style.display !== 'none') {
                count++;
              }
            });
          }
          
          // Actualizar el contador en el botón
          counterSpan.textContent = count;
        });
      }

      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          const selectedCategory = this.getAttribute('data-category');
          
          // Actualizar botones activos
          filterButtons.forEach(btn => {
            btn.classList.remove('bg-gold', 'text-charcoal');
            btn.classList.add('text-gold');
          });
          this.classList.add('bg-gold', 'text-charcoal');
          this.classList.remove('text-gold');

          // Filtrar productos
          let visibleCount = 0;
          productCards.forEach(card => {
            const cardCategory = card.getAttribute('data-category');
            if (selectedCategory === 'Todas las Categorías' || cardCategory === selectedCategory) {
              card.style.display = 'block';
              visibleCount++;
            } else {
              card.style.display = 'none';
            }
          });

          // Actualizar contadores después del filtrado
          updateCategoryCounters();

          // Mostrar mensaje si no hay productos
          if (visibleCount === 0) {
            noProductsMessage.classList.remove('hidden');
          } else {
            noProductsMessage.classList.add('hidden');
          }
        });
      });

      // Inicializar contadores al cargar la página
      updateCategoryCounters();
      
      // Activar "Todas las Categorías" por defecto
      filterButtons[0].click();
    });

    // Función para mostrar/ocultar detalles
    function toggleDetails(productId) {
      const detailsPanel = document.getElementById(`details-${productId}`);
      if (detailsPanel.classList.contains('hidden')) {
        detailsPanel.classList.remove('hidden');
      } else {
        detailsPanel.classList.add('hidden');
      }
    }

    // Función para eliminar producto (simulación)
    function removeProduct(productId) {
      const productCard = document.querySelector(`[data-product-id="${productId}"]`);
      if (productCard) {
        productCard.style.display = 'none';
        // Actualizar contadores después de eliminar
        updateCategoryCounters();
      }
    }
  </script>
</Layout>